# Oh-My-LiteCode (OML) 项目架构详解

## 概述
Oh-My-LiteCode (OML) 采用轻量级架构，专注于为 AI CLI 工具提供配置隔离和 API 灵活性。本架构借鉴了 Oh-My-OpenCode (OMO) 的理念，但针对资源受限的环境（如 Termux）进行了优化。

## 架构组件

### 1. 核心组件
- **分身脚本**: qwenx, geminix - 主要入口点
- **假 HOME 目录**: 隔离配置和认证数据
- **环境变量管理**: 控制 API 端点和密钥
- **MCP 服务器**: 扩展功能的集成点

### 2. 隔离层
```
真实环境
├── $HOME (~/)
├── $HOME/.qwen (原始配置)
├── $HOME/.gemini (原始配置)
└── API 密钥 (环境变量)

虚拟环境 (通过分身脚本)
├── $HOME (假路径 ~/.local/home/qwenx/)
├── $HOME/.qwen (隔离配置)
├── $HOME/.gemini (隔离配置)
└── 独立 API 密钥 (环境变量)
```

## 实现机制

### 1. 环境重定向
```bash
# 在分身脚本中
export _REALHOME="$HOME"
export _FAKEHOME="/data/data/com.termux/files/home/.local/home/<avatar>"
export HOME="$_FAKEHOME"
```

### 2. API 配置
- 每个分身使用独立的 API 端点
- 通过环境变量管理 API 密钥
- 支持 OpenAI 兼容的 API 端点

### 3. 参数处理
- 检测命令行参数以避免冲突
- 智能添加认证参数
- 保持与原始工具的兼容性

## 安全架构

### 1. 认证隔离
- 每个分身使用独立的认证环境
- API 密钥通过环境变量传递
- 避免认证信息交叉污染

### 2. 配置隔离
- 完全独立的配置文件
- 不同的模型提供商设置
- 独立的 MCP 服务器配置

### 3. 会话隔离
- 独立的会话历史
- 隔离的上下文管理
- 防止会话混淆

## 扩展性设计

### 1. MCP 服务器集成
- 支持 Context7、Websearch、Grep-app 等
- 通过 npx 动态加载
- 配置在隔离的设置文件中

### 2. 模型提供商
- 支持多种模型提供商
- 可配置的 API 端点
- 灵活的认证机制

## 与 OMO 架构对比

| 架构组件 | OMO | OML |
|----------|-----|-----|
| 代理数量 | 多个专业代理 | 2个主要分身 |
| 隔离方法 | 插件/模块系统 | 假 HOME 目录 |
| 资源占用 | 高 | 低 |
| 配置复杂度 | 高 | 低 |
| 扩展性 | 高 | 中等 |
| Termux 优化 | 一般 | 高 |
| 安装复杂度 | 中等 | 低 |

## 技术栈

### 1. 脚本语言
- **Shell**: Bash 脚本实现分身逻辑
- **Python**: 配置文件修改和处理
- **Node.js**: 原始 CLI 工具运行时

### 2. 配置格式
- **JSON**: 配置文件格式
- **环境变量**: 运行时配置

### 3. 通信协议
- **MCP (Model Context Protocol)**: 扩展功能集成
- **REST API**: 与 AI 服务通信

## 部署架构

### 1. 文件结构
```
~/.local/home/
├── qwenx/
│   └── .qwen/
│       ├── settings.json
│       └── ...
└── geminix/
    └── .gemini/
        ├── settings.json
        └── ...
```

### 2. 命令结构
```
系统 bin/
├── qwenx -> 分身脚本
├── geminix -> 分身脚本
└── oml -> 主入口脚本
```

## 性能考量

### 1. 资源使用
- 最小化内存占用
- 优化存储空间使用
- 高效的环境切换

### 2. 启动时间
- 快速环境变量设置
- 无额外初始化延迟
- 直接调用原始工具

## 维护架构

### 1. 更新机制
- 独立的分身更新
- 配置文件向后兼容
- 无缝迁移支持

### 2. 调试支持
- 详细的日志记录
- 环境变量追踪
- 配置验证机制

## 未来扩展

### 1. 插件系统
- 可能需要实现轻量级插件系统
- 模块化功能扩展
- 第三方集成支持

### 2. 云同步
- 配置文件云同步
- 会话状态同步
- 跨设备一致性

## 总结
OML 架构采用简约主义设计，专注于核心功能的实现。通过假 HOME 目录技术，实现了完全的配置和认证隔离，同时保持了轻量级和高效性。这种架构特别适合在资源受限的环境中使用，为用户提供了一个安全、高效的多实例管理方案。